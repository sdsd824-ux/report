const sheetURL =
"https://docs.google.com/spreadsheets/d/1yeh0HWHJKLxXzjAd0Zl9Bz1KawVrEtZLFcGePvKMcXk/gviz/tq?tqx=out:csv&sheet=보고양식";

let forms = [];

fetch(sheetURL)
  .then(res => res.text())
  .then(data => {
    const rows = data.split("\n").slice(1);

    forms = rows.map(row => {
      const cols = row.split(",");
      return {
        title: cols[0],
        category: cols[1],
        keywords: cols[2],
        content: cols.slice(3).join(",")
      };
    });

    renderAllForms();
  });

function renderAllForms(){
  const container = document.getElementById("allForms");
  container.innerHTML = "";

  forms.forEach(f => {
    container.appendChild(createCard(f));
  });
}

function createCard(form){
  const div = document.createElement("div");
  div.className = "card";
  div.innerHTML = `<b>${form.title}</b>`;
  div.onclick = () => showPreview(form.content);
  return div;
}

function showPreview(content){
  const results = document.getElementById("results");
  results.innerHTML = `
    <div class="preview">
      ${content}
      <br>
      <button onclick="copyText(\`${content}\`)">복사</button>
    </div>
  `;
}

function copyText(text){
  navigator.clipboard.writeText(text);
  alert("복사됨");
}

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();

  const filtered = forms.filter(f =>
    (f.title + f.category + f.keywords + f.content)
      .toLowerCase()
      .includes(q)
  );

  const results = document.getElementById("results");
  results.innerHTML = "";

  filtered.forEach(f => {
    results.appendChild(createCard(f));
  });
});

document.getElementById("aiBtn").addEventListener("click", async () => {

  const input = document.getElementById("aiInput").value;

  const prompt = `
다음 내용을 병원 원장에게 보고하는 업무 보고 형식으로 정리해줘.

내용:
${input}
`;

  document.getElementById("aiResult").innerText = "AI 작성중...";

  const response = await fetch("https://api.openai.com/v1/chat/completions",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer YOUR_API_KEY"
    },
    body:JSON.stringify({
      model:"gpt-4o-mini",
      messages:[{role:"user",content:prompt}]
    })
  });

  const data = await response.json();

  document.getElementById("aiResult").innerText =
    data.choices[0].message.content;
});
.card{
font-size:18px;
}

.preview{
font-size:16px;
line-height:1.6;
}

pre{
white-space:pre-wrap;
font-family:inherit;
}
  .modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.4);
display:none;
align-items:center;
justify-content:center;
}

.modalBox{
background:white;
padding:25px;
border-radius:14px;
width:90%;
max-width:500px;
max-height:80vh;
overflow:auto;
}

.modalTitle{
font-size:20px;
font-weight:bold;
margin-bottom:10px;
}

.modalButtons{
margin-top:15px;
display:flex;
gap:10px;
}

button{
font-size:16px;
}

  .card{
background:white;
padding:14px;
border-radius:10px;
margin-bottom:10px;
cursor:pointer;
box-shadow:0 2px 6px rgba(0,0,0,0.08);
transition:0.15s;
}

.card:hover{
transform:translateY(-2px);
box-shadow:0 6px 14px rgba(0,0,0,0.12);
}

.cardTitle{
font-weight:700;
}

.cardCategory{
font-size:12px;
color:#888;
margin-top:4px;
}
